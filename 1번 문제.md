## 동시에 같은 DB Table row 를 업데이트 하는 상황을 방어하기 위해 어떻게 개발하실 건지 설명해주세요.


### 서버 : 동시성 문제를 해결해야함
> 프로세스가 공유 자원을 동시에 읽고 쓰는 상황을 방지해야함
1. 메소드에 Synchronized 키워드 적용 
    - `주의` : 프로세스마다 적용되므로 서버가 여러 개일경우 (==다중 프로세스) 동시성 이슈 해결 안됨
2. 분산 락
    - Redis에 락에 대한 정보를 저장해두고, 각 서버가 임계 영역에 접근할 수 있는지 확인하도록 해야함
    - 서버가 여러대인 경우 사용
    - Redis 비용이 발생함, 때문에 충돌이 드물다면 분산락 쓰지 말고 DB에 Lock 거는 게 좋을듯 



### DB : Lock을 설정
> 트랜젝션 수행시 서로 끼어들지 못하게해서 `격리성`을 보장해야함
>
> -> 동시에 update하는 걸 방지하기 위해 DBMS에 `Lock`을 설정해줘야한다.



(아래는 `spring`,`Jpa`기준으로 서술하였음)

#### 동시 접근 빈도가 드문 곳 (e.g. 회원 정보) : `낙관적 락`

- 어플리케이션 레벨에서 충돌감지하게 됨.(트랜젝션 업데이트 전, 버전 속성의 변경 유무 확인 -> 버전이 다른 경우 예외 발생시킴)
- 충돌 시 롤백을 개발자가 직접 처리해 줘야함
- 비관적 락에 비해 성능 좋음

#### 동시 접근 빈도가 잦은 곳 (e.g. 재고량) `비관적 락`: 
- 무조건 데이터 경합이 발생할 것이라고 예상되는 곳에는 비관적 락을 걸어야 함 
- LockModeType 은 `PESSIMISTIC_WRITE` 사용
    - 트랜젝션이 데이터 write할 때 Lock건다.
    - 트랜젝션 수행 중에 다른 트랜젝션이 해당 데이터를 읽기 X , 쓰기 X

- DBMS에서 제공하는 `롤백 기능` 사용 가능
- 낙관적 락에 비해 성능은 다소 떨어지지만 `데이터 무결성` 보장
